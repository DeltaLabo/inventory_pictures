from PIL import Image, UnidentifiedImageError
from pathlib import Path
import os

# Ruta raíz del proyecto
root = Path(__file__).resolve().parent.parent

# Carpeta de entrada y salida
input_folder = root / "inventory_images"
output_folder = root / "inventory_images_ready"

# Crear la carpeta de salida si no existe
output_folder.mkdir(parents=True, exist_ok=True)

# Extensiones que quieres convertir
extensions = [".jpg", ".jpeg", ".bmp", ".gif", ".tiff"]

# Lista de archivos ya convertidos en la carpeta de salida
ready_files = {f.stem for f in output_folder.glob("*.png")}

# Tamaño deseado
target_size = (800, 800)

for filename in os.listdir(input_folder):
    file_path = input_folder / filename
    if file_path.suffix.lower() in extensions:
        new_filename = file_path.stem + ".png"
        if file_path.stem in ready_files:
            print(f"Ya convertido: {filename}")
            continue
        try:
            img = Image.open(file_path).convert("RGBA")
            # Ajusta proporcionalmente
            img.thumbnail(target_size, Image.LANCZOS)

            # Crea lienzo fijo con fondo blanco
            canvas = Image.new("RGBA", target_size, (255, 255, 255, 255))
            # Centra la imagen en el lienzo
            x = (target_size[0] - img.width) // 2
            y = (target_size[1] - img.height) // 2
            canvas.paste(img, (x, y), img)

            canvas.save(output_folder / new_filename)
            print(f"Convertido y ajustado: {filename} → {new_filename}")
        except UnidentifiedImageError:
            print(f"Archivo no válido como imagen: {filename}")
        except Exception as e:
            print(f"No se pudo convertir {filename}: {e}")
